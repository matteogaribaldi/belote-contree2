<div class="lobby-container">
  <!-- Notifiche -->
  <div class="notification error" *ngIf="errorMessage" [@fadeInOut]>
    <span class="notification-icon">‚ö†Ô∏è</span>
    <span class="notification-text">{{ errorMessage }}</span>
  </div>

  <button class="info-btn-fixed" (click)="showInfo()" title="Informazioni">
    <span>‚Ñπ</span>
  </button>

  <button class="stats-btn-fixed" (click)="showStats()" title="Statistiche">
    <span>üìä</span>
  </button>

  <div class="lobby-card">
    <div class="champions-logo">
      <picture>
        <source srcset="assets/champions.webp" type="image/webp">
        <img src="assets/champions.png" alt="Champions" class="champions-img">
      </picture>
    </div>

    <div class="input-group">
      <input
        type="text"
        [(ngModel)]="playerName"
        placeholder="Il tuo nome"
        maxlength="20"
        (keyup.enter)="activeRooms.length === 0 ? createRoom() : joinRoom()"
      />
    </div>

    <!-- Se NON ci sono stanze attive, mostra solo "Crea Partita" -->
    <div class="button-group" *ngIf="activeRooms.length === 0">
      <button class="btn-primary" (click)="createRoom()" [disabled]="!playerName.trim() || isCreatingRoom">
        <span *ngIf="!isCreatingRoom">Crea Partita</span>
        <span *ngIf="isCreatingRoom" class="loading-container">
          <span class="spinner"></span>
          <span>Creazione tavolo...</span>
        </span>
      </button>
    </div>

    <!-- Se c'√® una stanza attiva, mostra solo "Unisciti a Partita" e le info della stanza -->
    <div *ngIf="activeRooms.length > 0">
      <div class="active-rooms">
        <h3>Partita Disponibile</h3>
        <div class="room-list">
          <div class="room-item" *ngFor="let room of activeRooms">
            <div class="room-info">
              <span class="room-code">{{ room.code }}</span>
              <span class="room-host">Host: {{ room.hostName }}</span>
              <span class="room-players">{{ room.playerCount }}/4 giocatori</span>
            </div>
          </div>
        </div>
      </div>
      <div class="button-group">
        <button class="btn-primary" (click)="joinRoom()" [disabled]="!playerName.trim()">
          Unisciti a Partita
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Statistiche -->
  <div class="modal-overlay" *ngIf="showStatsModal" (click)="closeStats()">
    <div class="modal-content stats-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üìä Statistiche Partite</h2>
        <button class="close-btn" (click)="closeStats()">‚úï</button>
      </div>

      <div class="modal-body">
        <div *ngIf="loadingStats" class="loading-container">
          <span class="spinner"></span>
          <span>Caricamento statistiche...</span>
        </div>

        <div *ngIf="!loadingStats">
          <!-- Statistiche per giocatore -->
          <div *ngIf="playerStats.length > 0" class="section">
            <h3 class="section-title">üèÜ Classifica Giocatori</h3>
            <div class="player-stats-list">
              <div class="player-stat-item" *ngFor="let player of playerStats; let i = index">
                <div class="player-rank">{{ i + 1 }}</div>
                <div class="player-info">
                  <div class="player-name">{{ player.name }}</div>
                  <div class="player-record">{{ player.wins }} vittorie su {{ player.totalGames }} partite</div>
                </div>
                <div class="player-winrate">{{ (player.wins / player.totalGames * 100) | number:'1.0-0' }}%</div>
              </div>
            </div>
          </div>

          <!-- Lista partite -->
          <div *ngIf="gamesList.length > 0" class="section">
            <h3 class="section-title">üìã Ultime Partite</h3>
            <div class="games-list">
              <div class="game-item" *ngFor="let game of gamesList">
                <div class="game-header">
                  <span class="game-code">{{ game.roomCode }}</span>
                  <span class="game-date">{{ getFormattedDate(game.endedAt) }}</span>
                </div>
                <div class="game-players-grid">
                  <div class="game-player" [class.winner]="game.winningTeam === 'NS'">
                    <strong>N:</strong> {{ game.players.north.name }}
                    <span *ngIf="game.players.north.isBot" class="bot-badge">BOT</span>
                  </div>
                  <div class="game-player" [class.winner]="game.winningTeam === 'EW'">
                    <strong>E:</strong> {{ game.players.east.name }}
                    <span *ngIf="game.players.east.isBot" class="bot-badge">BOT</span>
                  </div>
                  <div class="game-player" [class.winner]="game.winningTeam === 'NS'">
                    <strong>S:</strong> {{ game.players.south.name }}
                    <span *ngIf="game.players.south.isBot" class="bot-badge">BOT</span>
                  </div>
                  <div class="game-player" [class.winner]="game.winningTeam === 'EW'">
                    <strong>W:</strong> {{ game.players.west.name }}
                    <span *ngIf="game.players.west.isBot" class="bot-badge">BOT</span>
                  </div>
                </div>
                <div class="game-score">
                  Punteggio: N/S {{ game.scoreNS }} - E/W {{ game.scoreEW }} ({{ game.totalHands }} mani)
                </div>
              </div>
            </div>
          </div>

          <!-- Empty state -->
          <div *ngIf="playerStats.length === 0 && gamesList.length === 0" class="empty-state">
            <span class="empty-icon">üìä</span>
            <p>Nessuna partita registrata nel database</p>
            <p class="empty-hint">Completa una partita per vedere le statistiche!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>