<div class="lobby-container">
  <!-- Notifiche -->
  <div class="notification error" *ngIf="errorMessage" [@fadeInOut]>
    <span class="notification-icon">‚ö†Ô∏è</span>
    <span class="notification-text">{{ errorMessage }}</span>
  </div>

  <button class="info-btn-fixed" (click)="showInfo()" title="Informazioni">
    <span>‚Ñπ</span>
  </button>
  <button class="history-btn-fixed" (click)="showHistory()" title="Storico Partite">
    <span>üìä</span>
  </button>
  <div class="lobby-card">
    <div class="champions-logo">
      <picture>
        <source srcset="assets/champions.webp" type="image/webp">
        <img src="assets/champions.png" alt="Champions" class="champions-img">
      </picture>
    </div>

    <div class="input-group">
      <input
        type="text"
        [(ngModel)]="playerName"
        placeholder="Il tuo nome"
        maxlength="20"
        (keyup.enter)="activeRooms.length === 0 ? createRoom() : joinRoom()"
      />
    </div>

    <!-- Se NON ci sono stanze attive, mostra solo "Crea Partita" -->
    <div class="button-group" *ngIf="activeRooms.length === 0">
      <button class="btn-primary" (click)="createRoom()" [disabled]="!playerName.trim() || isCreatingRoom">
        <span *ngIf="!isCreatingRoom">Crea Partita</span>
        <span *ngIf="isCreatingRoom" class="loading-container">
          <span class="spinner"></span>
          <span>Creazione tavolo...</span>
        </span>
      </button>
    </div>

    <!-- Se c'√® una stanza attiva, mostra solo "Unisciti a Partita" e le info della stanza -->
    <div *ngIf="activeRooms.length > 0">
      <div class="active-rooms">
        <h3>Partita Disponibile</h3>
        <div class="room-list">
          <div class="room-item" *ngFor="let room of activeRooms">
            <div class="room-info">
              <span class="room-code">{{ room.code }}</span>
              <span class="room-host">Host: {{ room.hostName }}</span>
              <span class="room-players">{{ room.playerCount }}/4 giocatori</span>
            </div>
          </div>
        </div>
      </div>
      <div class="button-group">
        <button class="btn-primary" (click)="joinRoom()" [disabled]="!playerName.trim()">
          Unisciti a Partita
        </button>
      </div>
    </div>
  </div>

  <!-- Modal per lo storico partite -->
  <div class="history-modal" *ngIf="showHistoryModal" [@fadeInOut] (click)="closeHistory()">
    <div class="history-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeHistory()">‚úï</button>
      <h2>üìä Storico Partite</h2>

      <div class="history-stats" *ngIf="gameHistory">
        <p>Totale partite completate: <strong>{{ gameHistory.totalGames }}</strong></p>
      </div>

      <div class="loading" *ngIf="loadingHistory">
        <div class="spinner"></div>
        <p>Caricamento...</p>
      </div>

      <div class="history-list" *ngIf="!loadingHistory && gameHistory">
        <div class="history-item" *ngFor="let game of gameHistory.games">
          <div class="game-header">
            <span class="game-code">üéÆ {{ game.room_code }}</span>
            <span class="game-date">{{ formatDate(game.timestamp) }}</span>
          </div>
          <div class="game-players">
            <span *ngFor="let player of game.players"
                  [class.bot-player]="player.isBot">
              {{ player.name }} ({{ player.position }})
            </span>
          </div>
          <div class="game-result">
            <span class="winner">üèÜ {{ game.winner_team === 'northSouth' ? 'Nord-Sud' : 'Est-Ovest' }}</span>
            <span class="score">{{ game.finalScore.northSouth }} - {{ game.finalScore.eastWest }}</span>
            <span class="hands">{{ game.hands_played }} mani</span>
          </div>
        </div>

        <div class="no-games" *ngIf="gameHistory.games.length === 0">
          <p>Nessuna partita completata ancora</p>
        </div>
      </div>
    </div>
  </div>
</div>