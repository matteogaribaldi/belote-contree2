<div class="waiting-room-container">
  <!-- Notifiche -->
  <div class="notification"
       *ngIf="notification"
       [@fadeInOut]
       [class.success]="notificationType === 'success'"
       [class.error]="notificationType === 'error'"
       [class.info]="notificationType === 'info'">
    <span class="notification-icon" *ngIf="notificationType === 'success'">‚úÖ</span>
    <span class="notification-icon" *ngIf="notificationType === 'error'">‚ö†Ô∏è</span>
    <span class="notification-icon" *ngIf="notificationType === 'info'">‚ÑπÔ∏è</span>
    <span class="notification-text">{{ notification }}</span>
  </div>

  <div class="waiting-card">
    <div class="header">
      <h2>Sala d'Attesa - Taribo</h2>
      <div class="room-code">
        <span>Condividi link al tavolo</span>
        <button class="btn-copy" (click)="copyRoomCode()" title="Copia link condivisibile">üîó</button>
      </div>
    </div>

    <div class="table-layout" *ngIf="roomState">
      <div class="position north">
        <div
          class="player-slot"
          [class.available]="isPositionAvailable('north')"
          [class.selected]="isMyPosition('north')"
          (click)="choosePosition('north')"
        >
          <div class="position-label">{{ positionLabels['north'] }}</div>
          <div class="player-name">{{ getPositionDisplay('north') }}</div>
          <button
            *ngIf="isHost() && roomState.players['north'] === null"
            class="btn-bot"
            (click)="toggleBot('north'); $event.stopPropagation()"
          >
            {{ roomState.bots['north'] ? 'Rimuovi BOT' : 'Aggiungi BOT' }}
          </button>
        </div>
      </div>

      <div class="position west">
        <div
          class="player-slot"
          [class.available]="isPositionAvailable('west')"
          [class.selected]="isMyPosition('west')"
          (click)="choosePosition('west')"
        >
          <div class="position-label">{{ positionLabels['west'] }}</div>
          <div class="player-name">{{ getPositionDisplay('west') }}</div>
          <button
            *ngIf="isHost() && roomState.players['west'] === null"
            class="btn-bot"
            (click)="toggleBot('west'); $event.stopPropagation()"
          >
            {{ roomState.bots['west'] ? 'Rimuovi BOT' : 'Aggiungi BOT' }}
          </button>
        </div>
      </div>

      <div class="center">
        <div class="table-center">üé¥</div>
      </div>

      <div class="position east">
        <div
          class="player-slot"
          [class.available]="isPositionAvailable('east')"
          [class.selected]="isMyPosition('east')"
          (click)="choosePosition('east')"
        >
          <div class="position-label">{{ positionLabels['east'] }}</div>
          <div class="player-name">{{ getPositionDisplay('east') }}</div>
          <button
            *ngIf="isHost() && roomState.players['east'] === null"
            class="btn-bot"
            (click)="toggleBot('east'); $event.stopPropagation()"
          >
            {{ roomState.bots['east'] ? 'Rimuovi BOT' : 'Aggiungi BOT' }}
          </button>
        </div>
      </div>

      <div class="position south">
        <div
          class="player-slot"
          [class.available]="isPositionAvailable('south')"
          [class.selected]="isMyPosition('south')"
          (click)="choosePosition('south')"
        >
          <div class="position-label">{{ positionLabels['south'] }}</div>
          <div class="player-name">{{ getPositionDisplay('south') }}</div>
          <button
            *ngIf="isHost() && roomState.players['south'] === null"
            class="btn-bot"
            (click)="toggleBot('south'); $event.stopPropagation()"
          >
            {{ roomState.bots['south'] ? 'Rimuovi BOT' : 'Aggiungi BOT' }}
          </button>
        </div>
      </div>
    </div>

    <div class="actions" *ngIf="isHost()">
      <div class="target-score-selection">
        <label>Punteggio da raggiungere:</label>
        <div class="score-options">
          <button
            class="btn-score"
            [class.selected]="roomState.targetScore === 301"
            (click)="setTargetScore(301)"
          >
            301
          </button>
          <button
            class="btn-score"
            [class.selected]="roomState.targetScore === 501"
            (click)="setTargetScore(501)"
          >
            501
          </button>
          <button
            class="btn-score"
            [class.selected]="roomState.targetScore === 701"
            (click)="setTargetScore(701)"
          >
            701
          </button>
        </div>
      </div>
      <button
        class="btn-start"
        (click)="startGame()"
        [disabled]="!allPositionsFilled()"
      >
        Inizia Partita
      </button>
      <button
        class="btn-delete"
        (click)="deleteRoom()"
      >
        Cancella Tavolo
      </button>
      <p class="hint" *ngIf="!allPositionsFilled()">
        Tutti i posti devono essere occupati per iniziare
      </p>
    </div>

    <div class="waiting-message" *ngIf="!isHost()">
      <p>In attesa che l'host avvii la partita...</p>
      <button
        class="btn-back"
        (click)="goBack()"
      >
        Torna alla Lobby
      </button>
    </div>
  </div>
</div>
